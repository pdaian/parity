Snow White
----------

Snow White is the first provably secure proof of stake algorithm implemented on top of Ethereum, currently for the *permissioned* setting
(fixed set of participants known a priori).  We plan on generalizing Snow White to the permissionless setting for USENIX Security '17.

Snow White relies on the "honest participant/coin majority" assumption.  There is some debate on the vulnerability of this model to attack
in the permissionless context: https://blog.ethereum.org/2016/12/06/history-casper-chapter-1/ and more research is needed before deploying
a live financial system with this algorithm.

Code Changes / Diff Description
-------------------------------

Our system is based off of Parity (github.com/ethcore/parity), the fastest and most robust Ethereum blockchain implementation available.

A full diff of our system to Parity is available here: https://github.com/ethcore/parity/compare/master...pdaian:snowwhite

The "core changes" (changes to mining algorithms, consensus, and their tests) are approximately 600-800 lines of code.

The "auxilliary changes" (including management scripts, experiments, etc.) are approximately 1200 lines of code.

The full diff is larger, as it includes "explorer", a modified version of EtherParty (see the explorer section below) that 
*we modified but did not write*.  Explorer is not included in the above Github diff for simplicity of code analysis, but is 
included in the final SnowWhite tarball.

The key changes are as follows (in order of importance):

- ethcore/src/engines/snow_white.rs : The Core Snow White algorithm.  Some code/tests borrowed from engines/basic_authority.rs; in these cases,
   a comment is included indicating that the code is "the same as BasicAuthority".  These are the core consensus algorithm changes, and
   represent a robust core of extensively tested (through deployment clusters) code.
-  ethcore/src/engines/mod.rs : The generic Ethcore engines framework.  Here, we reintroduce the difficulty adjustment algorithm used in
   Ethereum, which previously was not required for permissioned engines.
- pyrpc : this folder contains an interface for interacting with SnowWhite through RPC, and several useful scripts described later in this doc
- util : installation / management / measurement utilities described later in this document.
- config-skeleton : example configuration files described later in this document.

There are several smaller changes to infrastructure that are procedural / uninteresting.

Please don't hestitate to contact me about any questions or confusions regarding either the diff provided or its description.

Prerequisites
-------------

To build and run SnowWhite, you must:

- Install git, make, gcc, and g++.  On Ubuntu, you can ``sudo apt-get install git make build-essential g++`` to satsify these 
    dependencies. 
- Install stable Rust through rustup (https://www.rustup.rs/).  On Linux, simply run ``curl https://sh.rustup.rs -sSf | sh`` 
    in the command line.


Running the System - One Node
-----------------------------



To run at diferent info levels,

To compile in debug mode (with debug symbols, stacktraces, but lower performance) run ``cargo build --debug".  Then, replace any commands
in this document or related scripts that use ``target/release`` with ``target/debug``.  This is not recommended due to a far lower level
of performance (~20x slower in our testing).


Running the Block Explorer
--------------------------

SnowWhite comes with a minorly modified version of EtherParty (https://github.com/etherparty/explorer/), a blockchain explorer that
allows you to visualize the chain generated by SnowWhite.  

This is bundled with the copy of Parity included in this project's tgz.  To run the block explorer, simply install ``npm nodejs``,
and make sure the ``node`` CLI command opens node.js (on some distros, including Ubuntu 14.04, bundled with AWS, this may require 
creating a symlink like ``ln -s /usr/bin/nodejs /usr/bin/node``).

Connecting Multiple Nodes
-------------------------

The first step in running the system with multiple nodes is to run a single "anchor node" as in the "one node" instructions.




Management - RPC and SSH
------------------------

Once either a single or multiple node instance of SnowWhite is spawned, you can 




Running Tests
-------------

To run unit tests of Snow White only, run:
	cargo test snow -p ethcore

in the root of the project directory.

Any test with "NEW" as a prefix in the name was added specifically for SnowWhite.  Any test without "NEW" as a prefix was carried over
from the BasicAuthority module described in the "Code Changes" section.


Gathering Graphs/Data
---------------------

To gather the graphs and data in the final report, the following process was used:

1. Start a multi-node mining network as described in the "Connecting Multiple Nodes" section.  Do not begin mining yet. 
2. Run "util/process3dGraph.py".  This will begin gathering data for the resource consumption (CPU, memory) graphs drawn.
3. Start mining on a single node as described in "Connecting Multiple Nodes".
4. Wait a minute or so.
5. Start mining on multiple nodes as described in "Connecting Multiple Nodes".  Do not mine on the node gathering data.
6. Optionally, start mining on the node gathering data.
7. Stop mining on all nodes.
8. To gather a summary of the blockchain generated by these nodes, add the node IPs to a file "~/nodes", one IP per line.
9. Run "gather_blockchain_data.py" in the "pyrpc" folder.  This will gather the blockchain statistics used in the first graphs.
   Preferably, do this on the same machine used to gather CPU/memory data (in case of blockchain forks), but any machine should do.
10. Enjoy the graphs!


Modifying the Chain Spec
-------------------------

To modify the chain specification, including adding or removing authorities mid-chain, simply modify the ``chain_spec.json`` file as desired.

Specifically, accounts can easily be added or removed from the ``authorities`` field to enable these accounts to mine.  Note that if two nodes
in a multiple node network have different ``authorities`` sets, their chains may diverge, leading to consensus failure.

Other parameters of the chain that can be modified are covered in the Parity documentation here: 
     https://github.com/ethcore/parity/wiki/Private-chains


Original README
---------------

The original Parity README is included in PARITY_README.md and contains general information on Parity, the upstream system of SnowWhite.


Assistance?
-----------

This project represents a modification to an extremely complex and experimental distributed consensus system.  While I believe the above 
instructions are comprehensive and should be workable, please don't hesitate to contact me with any questions / requests for clarification.

While I have also tried to test this system extensively (on both AWS clusters and with some unit testing), it is possible that consensus bugs
may result in the blockchain forking permanently at some point or ceasing to process new blocks (in case of the violation of a fundamental
time constraint).  If this rare scenario occurs, I am happy to do a postmorterm and explain how to proceed.

E-mail me any time at pad242@cornell.edu.  I will also be on campus until at least Thursday, Dec. 15 and can walk through setup or
experiments in person.
